{% extends 'master.html' %}
{% block content %}
<div class="container-fluid">

    {% if orders.count > 0 %}
    <div class="row">
        <div class="col-xs-12 col-md-9">
            <h1 class="text-light ">Manage Commissions</h1>
        </div>
        <div class="col-xs-12 col-md-3 d-flex align-content-center align-items-center">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="show-test-orders-switch" data-show-test="False">
                <label class="custom-control-label" for="show-test-orders-switch">Show Test Orders</label>
            </div>
        </div>
        <script>
            document.getElementById('show-test-orders-switch').addEventListener('change', (event) => {
                let current = event.target.dataset.showTest;
                if (current === "False") {
                    // changing to show only test
                    document.querySelectorAll('.order').forEach((el, i) => {
                        if (el.dataset.test === "True") {
                            el.classList.remove('d-none');
                        } else {
                            el.classList.add('d-none');
                        }
                    })
                    event.target.dataset.showTest = "True";
                } else {
                    // changing to show only non test
                    document.querySelectorAll('.order').forEach((el, i) => {
                        if (el.dataset.test === "True") {
                            el.classList.add('d-none');
                        } else {
                            el.classList.remove('d-none');
                        }
                    })
                    event.target.dataset.showTest = "False";
                }
            });
        </script>
    </div>
    <hr />
    <div class="row my-3">
        {% for o in orders %}
        <div class=" col-xs-12 col-md-3 order {% if o.test %} d-none {% endif %}" data-test="{{o.test}}">
            <div class="cart-item-card card m-1 text-center ">
                {% if o.product.s3_reference_image_url %}
                <img class="reference-image-preview card-img-top" src="{{o.product.s3_reference_image_url}}"
                    alt="{{item.name}} reference" style="height: fit-content; margin:0 auto;">
                {% else %}
                <span>No reference image</span>
                {% endif %}
                <div class="card-body text-left">
                    <h5 class="card-title">{{o.product.name}}, ${{o.product.price}} {% if o.test %} (TEST) {% endif %}
                    </h5>
                    <p class="card-text text-dark text-left">
                        <span>Requested by: {{o.user_profile.user.username}}</span>
                        <span>{{o.product.description}}</span><br />
                        <span>Commissioned on {{o.timestamp}}</span><br />
                        <span>Status: {{o.product.get_status_display}}</span><br />
                        <span>Completed on: {% if o.product.status == 'CMPLT' %}
                            {{o.product.completion_date}}
                            {% else %}
                            Not Complete
                            {% endif %}</span>
                    </p>
                    <a class="btn btn-sm btn-secondary" href="{% url 'manage-order' o.id %}"
                        title="manage order {{o.id}}">
                        <i class="fa fa-edit"></i> Update
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <h1 class="text-light">You have not yet commissioned any drawings.</h1>
    <h2 class="text-light">
        If you'd like to commission me, you can choose items from the
        <a href="{% url 'commissions' %}" title="commissions">commissions page.</a>
    </h2>
    {% endif %}

</div>
{% endblock %}